@namespace HITSBlazor.Components.LeftSideNavigation

<div class="bg-white border-end" 
     style="height: 100vh; width: 85px; min-width: 85px; max-width: 85px;"
     @onmouseenter="HandleMouseEnter"
     @onmouseleave="HandleMouseLeave">
    @if (isLoading)
    {
        <div class="p-3 d-flex flex-column gap-2">
            @for (int i = 0; i < 6; i++)
            {
                <div class="placeholder-glow w-100">
                    <span class="placeholder w-100 bg-secondary rounded small" style="height: 50px"></span>
                </div>
            }
        </div>
    }
    else
    {
        <div class="p-3 h-100 left-side-bar" style="@GetSidebarStyles()">
            <ul class="left-side-bar-content nav nav-pills w-100 gap-2"
                style="width: 280px; min-width: 280px; max-width: 280px; display: flex; flex-direction: column; flex-wrap: nowrap; align-items: flex-start; justify-content: flex-start; gap: 8px">
                <li class="@ulElementClass">
                    <button class="@ulElementButtonClass @GetActiveItemStyle(0)">
                        <i class="icon bi bi-lightbulb fs-5"></i>
                        @if (isHovered)
                        {
                            <span class="fs-6 ms-2">Реестр идей</span>
                        }
                    </button>
                </li>
                <li class="@ulElementClass">
                    <button class="@ulElementButtonClass @GetActiveItemStyle(1)">
                        <i class="icon bi bi-people fs-5"></i>
                        @if (isHovered)
                        {
                            <span class="fs-6 ms-2">Реестр команд</span>
                        }
                    </button>
                </li>
                <li class="@ulElementClass">
                    <button class="@ulElementButtonClass @GetActiveItemStyle(2)">
                        <i class="icon bi bi-shop-window fs-5"></i>
                        @if (isHovered)
                        {
                            <span class="fs-6 ms-2">Реестр бирж</span>
                        }
                    </button>
                </li>
                <li class="@ulElementClass">
                    <button class="@ulElementButtonClass @GetActiveItemStyle(3)">
                        <i class="icon bi bi-ui-checks-grid fs-5"></i>
                        @if (isHovered)
                        {
                            <span class="fs-6 ms-2">Админ панель</span>
                        }
                    </button>
                </li>
                <li class="@ulElementClass">
                    <button class="@ulElementButtonClass @GetActiveItemStyle(4)">
                        <i class="icon bi bi-briefcase fs-5"></i>
                        @if (isHovered)
                        {
                            <span class="fs-6 ms-2">Реестр проектов</span>
                        }
                    </button>
                </li>
                <li class="@ulElementClass">
                    <button class="@ulElementButtonClass @GetActiveItemStyle(5)">
                        <i class="icon bi bi-clipboard fs-5"></i>
                        @if (isHovered)
                        {
                            <span class="fs-6 ms-2">Тесты</span>
                        }
                    </button>
                </li>
            </ul>
            <div class="d-flex flex-column gap-2">
                <button class="btn d-flex btn-light w-100 text-success" type="button">
                    <i class="icon bi bi-circle-fill fs-5"></i>
                </button>
                <button class="btn d-flex btn-light w-100" type="button">
                    <i class="icon bi bi-box-arrow-left fs-5"></i>
                </button>
            </div>
        </div>
    }
</div>

@code {
    private bool isLoading = false;
    private bool isHovered = false;
    private int activeItemNum = 0;
    private Timer? _closeTimer;

    private string ulElementClass = "nav-item";
    private string ulElementStyle = "";
    private string ulElementButtonClass = "nav-link d-flex w-100";

    private void HandleMouseEnter()
    {
        isHovered = true;
        ulElementClass = "nav-item w-100";
        ulElementStyle = "border-radius: 6px; transition: background-color .15s ease-out";
        StateHasChanged();
    }

    private void HandleMouseLeave()
    {
        isHovered = false;
        ulElementClass = "nav-item";
        ulElementButtonClass = "nav-link d-flex w-100";
        StateHasChanged();
    }

    private string GetSidebarStyles()
    {
        var styles = new System.Text.StringBuilder();

        styles.Append("position: relative;");
        styles.Append("top: auto;");
        styles.Append("right: auto;");
        styles.Append("bottom: auto;");
        styles.Append("left: auto;");
        styles.Append("z-index: 8;");
        styles.Append("overflow-x: hidden;");
        styles.Append("display: flex;");
        styles.Append("flex-direction: column;");
        styles.Append("flex-wrap: nowrap;");
        styles.Append("align-items: stretch;");
        styles.Append("justify-content: space-between;");
        styles.Append("gap: 8px;");

        styles.Append("transition: all 0.15s ease-out;");

        if (isHovered)
        {
            styles.Append("width: 312px;");
            styles.Append("background-color: rgba(0, 0, 0, 0.729);");
            styles.Append("color: #fff;");
        }
        else
        {
            styles.Append("width: 80px;");
            styles.Append("background-color: transparent;");
            styles.Append("color: inherit;");
        }

        return styles.ToString();
    }

    private string GetActiveItemStyle(int itemNum)
    {
        if (itemNum == activeItemNum) return "bg-primary text-white";
        else if (isHovered) return "text-white";
        else return "text-black";

    }

    private string GetActiveItemBGColor(int itemNum) => itemNum == activeItemNum ? "bg-primary" : "";
    private string GetActiveItemTextColor(int itemNum) => itemNum == activeItemNum ? "text-white" : "text-black";
}