@namespace HITSBlazor.Components.Modals.RightSideModals.ShowTeamModal
@using HITSBlazor.Components.Collapse
@using HITSBlazor.Components.Modals.Components.ModalHeader
@using HITSBlazor.Components.Tables.TableActionMenu
@using HITSBlazor.Components.Tables.TableBodyRow
@using HITSBlazor.Components.Tables.TableHeader
@using HITSBlazor.Utils.EnumStyles
@using HITSBlazor.Utils.EnumTranslators

<div class="right-side-modal p-3 overflow-y-scroll" @onclick:stopPropagation="true">
    @if (!_isLoading && _currentTeam is not null)
    {
        <div class="team-modal-side w-75">
            <ModalHeader Title="@_currentTeam.Name" />
            <ul class="list-group rounded-3">
                <li class="list-group-item p-0 overflow-hidden">
                    <Collapse StartCollapsed="false">
                        <MainContent Context="collapse">
                            <button type="button"
                                    @onclick="@(() => collapse.Toggle())"
                                    class="btn d-flex btn-light collapse-controller w-100">
                                Описание команды
                            </button>
                        </MainContent>
                        <ExpandedContent>
                            <div class="list-group">
                                <div class="p-2">
                                    @_currentTeam.Description
                                </div>
                            </div>
                        </ExpandedContent>
                    </Collapse>
                </li>
            </ul>
            <div class="bg-white rounded-3">
                <div class="border-bottom px-3">
                    <ul class="nav nav-underline">
                        <!-- active text-primary при активной категории -->
                        <!-- сделать pointer -->
                        <div class="nav-link fw-normal pb-1 @GetCategoryClass(_isMembersCategory)">Участники</div>
                        <div class="nav-link fw-normal pb-1 text-secondary">Приглашения в команду</div>
                        <div class="nav-link fw-normal pb-1 text-secondary">Заявки в команду</div>
                        <div class="nav-link fw-normal pb-1 text-secondary">Заявки в идеи</div>
                        <div class="nav-link fw-normal pb-1 text-secondary">Приглашения в идеи</div>
                    </ul>
                </div>
                <div class="team-modal-tables">
                    <div class="w-100 bg-white px-3 pb-3 pt-1">
                        <div class="py-2 d-flex justify-content-between">
                            <div class="w-50">
                                <div class="input-group">
                                    <sapn class="input-group-text fs-6">
                                        <i class="bi bi-search"></i>
                                    </sapn>
                                    <input type="text" placeholder="Поиск" class="form-control rounded-end" />
                                </div>
                            </div>
                        </div>
                        <div class="w-100 d-flex">
                            <div class="w-100">
                                <table class="table table-hover mb-0">
                                    @if (_isMembersCategory)
                                    {
                                        <TableHeader TableActionMenuIsEnable="true" Items="GetMembersTableHeader()" />
                                    }
                                    else if (_isInvitationsCategory || _isRequestsInTeamCategory)
                                    {
                                        <TableHeader TableActionMenuIsEnable="true" Items="GetNewMembersTableHeader()" />
                                    }
                                    <tbody>
                                        @if (_isMembersCategory)
                                        {
                                            @foreach (var member in _currentTeam.Members)
                                            {
                                                <tr>

                                                </tr>
                                            }
                                        }
                                        else if (_isInvitationsCategory)
                                        {
                                            @foreach (var invitation in _teamInvitations)
                                            {
                                                <tr>
                                                    <TableBodyRow IsCentered="true">
                                                        <div class="px-2 py-1 rounded-4 @invitation.Status.GetStyle()">
                                                            @invitation.Status.GetTranslation()
                                                        </div>
                                                    </TableBodyRow>
                                                    <TableBodyRow IsCentered="true">
                                                        <div class="data-link">
                                                            @invitation.Email
                                                        </div>
                                                    </TableBodyRow>
                                                    <TableBodyRow IsCentered="true">
                                                        @invitation.FirstName
                                                    </TableBodyRow>
                                                    <TableBodyRow IsCentered="true">
                                                        @invitation.LastName
                                                    </TableBodyRow>
                                                    <TableActionMenu ItemId="invitation.UserId"
                                                                     OnAction="@HandleTableMenuClick"
                                                                     Actions="@(new List<TableAction> { TableAction.ViewProfile })" />
                                                </tr>
                                            }
                                        }
                                        else if (_isRequestsInTeamCategory)
                                        {
                                            @foreach (var request in _requestsToTeam)
                                            {
                                                <tr>
                                                    <TableBodyRow IsCentered="true">
                                                        <div class="px-2 py-1 rounded-4 @request.Status.GetStyle()">
                                                            @request.Status.GetTranslation()
                                                        </div>
                                                    </TableBodyRow>
                                                    <TableBodyRow IsCentered="true">
                                                        <div class="data-link">
                                                            @request.Email
                                                        </div>
                                                    </TableBodyRow>
                                                    <TableBodyRow IsCentered="true">
                                                        @request.FirstName
                                                    </TableBodyRow>
                                                    <TableBodyRow IsCentered="true">
                                                        @request.LastName
                                                    </TableBodyRow>
                                                    <TableActionMenu ItemId="request.UserId"
                                                                     OnAction="@HandleTableMenuClick"
                                                                     Actions="@(new List<TableAction> { 
                                                                        TableAction.ViewProfile, 
                                                                        TableAction.TeamRequestAccept,
                                                                        TableAction.TeamRequestCancel 
                                                                     })" />
                                                </tr>
                                            }
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="rounded-3 bg-white p-3 d-flex flex-wrap gap-3">
                <button type="button" class="btn d-flex btn-light">
                    Редактировать
                </button>
                <button type="button" class="btn d-flex btn-danger">
                    Удалить команду
                </button>
                <button type="button" class="btn d-flex btn-primary">
                    Пригласить пользователя
                </button>
            </div>
        </div>
        <div class="team-modal-side rounded-3 w-25 bg-white">
            <div class="p-2 rounded-top d-flex gap-2">
                <!-- btn-secondary на НЕ активной категории -->
                <button type="button" class="btn d-flex btn-primary w-50">
                    Информация
                </button>
                <button type="button" class="btn d-flex btn-secondary w-50">
                    Компетенции
                </button>
            </div>
            <div class="team-modal-info w-100 pb-3 px-3">
                <div class="w-100">
                    <span class="fs-6 border-bottom text-secondary d-block">Владелец команды</span>
                    <div class="team-modal-info-item pt-2">
                        <i class="bi bi-person-circle text-secondary fs-3 opacity-25"></i>
                        <div class="data-link">
                            <span class="fs-6">
                                @_currentTeam.Owner?.FirstName @_currentTeam.Owner?.LastName
                            </span>
                        </div>
                    </div>
                </div>
                <div class="w-100">
                    <span class="fs-6 border-bottom text-secondary d-block">Тим-лидер команды</span>
                    <div class="team-modal-info-item pt-2">
                        <i class="bi bi-person-circle text-secondary fs-3 opacity-25"></i>
                        <div class="data-link">
                            <span class="fs-6">
                                @_currentTeam.Leader?.FirstName @_currentTeam.Leader?.LastName
                            </span>
                        </div>
                    </div>
                </div>
                <div class="w-100">
                    <span class="fs-6 border-bottom text-secondary d-block">Дата создания</span>
                    <div class="team-modal-info-item pt-2">
                        <i class="bi bi-calendar-date text-secondary fs-3 opacity-25"></i>
                        <span class="fs-6 text-primary">@_currentTeam.CreatedAt.ToString("dd.MM.yyyy")</span>
                    </div>
                </div>
                <div class="w-100">
                    <span class="fs-6 border-bottom text-secondary d-block">
                        Количество участников:
                        <span class="fs-6 text-primary">@_currentTeam.MembersCount</span>
                    </span>
                </div>
                <button type="button" class="btn d-flex btn-primary">
                    Поделиться командой
                </button>
            </div>
        </div>
    }
</div>