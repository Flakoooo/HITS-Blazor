@namespace HITSBlazor.Components.SelectActiveRoleModal
@using HITSBlazor.Models.Users.Enums
@using HITSBlazor.Services
@using HITSBlazor.Services.Auth
@using HITSBlazor.Services.Modal
@using HITSBlazor.Utils
@using HITSBlazor.Utils.EnumTranslators
@inject IAuthService AuthService
@inject ModalService ModalService

<div @onclick:stopPropagation="true"
     class="p-3 rounded bg-white"
     style="width: 400px; display: flex; flex-direction: column; flex-wrap: nowrap; align-items: stretch; justify-content: stretch; gap: 12px; align-self: center; justify-self: center; transition: all .15s ease-out;">
    <span class="fs-3 text-primary text-center">Доступные роли</span>
    @foreach (var role in Roles)
    {
        <button type="button" @onclick="() => SetUserRole(role)" class="btn d-flex btn-primary" style="@Styles.Btn">
            @role.GetTranslation()
        </button>
    }
</div>

@code {
    public List<RoleType> Roles { get; set; } = [];

    protected override async Task OnInitializedAsync()
    {
        Roles = AuthService.CurrentUser?.Roles ?? [];
    }

    private async void SetUserRole(RoleType role)
    {
        await AuthService.SetUserRoleAsync(role);
        ModalService.Close();
    }
}